使用双dp，把树看作一个个子树，dp1记录使用子树根节点的最大值，dp2记录不使用根节点的最大值。由于是完全二叉树，根节点i和左右子节点2i+1和2i+2存在索引联系。从末端向根遍历，输出根节点在dp1和dp2中的最大值。

```python
N=int(input())
t=list(map(int,input().split()))
dp1=[0]*N
dp2=[0]*N
for i in range(N-1,-1,-1):
    if 2*i+2<N:
        dp1[i]=t[i]+dp2[2*i+1]+dp2[2*i+2]
        dp2[i]=max(dp2[2*i+1]+dp1[2*i+2],dp1[2*i+1]+dp2[2*i+2],dp1[i*2+1]+dp1[i*2+2],dp2[i*2+1]+dp2[i*2+2])
    elif 2*i+1<N:
        dp1[i]=t[i]
        dp2[i]=dp1[2*i+1]
    else:
        dp1[i]=t[i]
print(max(dp1[0],dp2[0]))
```

