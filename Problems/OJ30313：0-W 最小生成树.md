大部分点之间有0边，如果对于每个点都搜索他和其他所有点之间是否有临边，时间复杂度会达到O(n^2)，这是无法接受的。使用BFS，从任意起点开始，每合并一个节点，就把这个节点删除，同时从这个节点向外搜索其他能连通的节点，可以使时间复杂度降到O(n)。将已经合并的几个大板块映射到一个新的节点集中。然后运用最小生成树的Kruskal算法对新节点集建树，此操作时间复杂度为O(n+m)。

```python
class UnionFind:
    def __init__(self, N):
        self.parent = list(range(N))
        self.rank = [0] * N
        self.n=N

    def find(self, x):
        if self.parent[x] != x:
            self.parent[x] = self.find(self.parent[x])
        return self.parent[x]

    def union(self, x, y):
        root_x, root_y = self.find(x), self.find(y)
        if root_x == root_y:
            return False
        if self.rank[root_x] < self.rank[root_y]:
            self.parent[root_x] = root_y
        elif self.rank[root_x] > self.rank[root_y]:
            self.parent[root_y] = root_x
        else:
            self.parent[root_y] = root_x
            self.rank[root_x] += 1
        return True
    def count(self):
        switch_id={}
        count=0
        for i in range(self.n):
            root=self.find(i)
            if root not in switch_id:
                switch_id[root]=count
                count+=1
        return switch_id,count

from collections import deque,defaultdict
n,m=map(int,input().split())
uf1=UnionFind(n)
edges=[]
assign=defaultdict(set)
for _ in range(m):
    u,v,w=map(int,input().split())
    edges.append((w,u-1,v-1))
    assign[u-1].add(v-1)
    assign[v-1].add(u-1)
unvisited=set(range(n))
while unvisited:
    start=unvisited.pop()
    queue=deque([start])
    while queue:
        u=queue.popleft()
        re=list(unvisited)
        for v in re:
            if v not in assign[u]:
                uf1.union(u,v)
                unvisited.remove(v)
                queue.append(v)
com_id,com_count=uf1.count()
uf2=UnionFind(com_count)
edges.sort()
total_weight=0
for w,u,v in edges:
    c_u=com_id[uf1.find(u)]
    c_v=com_id[uf1.find(v)]
    if uf2.union(c_u,c_v):
        total_weight+=w
        com_count-=1
        if com_count==1:
            break
print(total_weight)
```

