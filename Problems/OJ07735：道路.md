用变体Dijkstra算法，用dist[location] [cost] 记录到达同位置同花费下的最小路径长度。由于不同道路的起点和终点可能相同，因此用邻接表记录路径。

```python
import heapq
K=int(input())
N=int(input())
R=int(input())
road=[[] for _ in range(N+1)]
for _ in range(R):
    S,D,L,T=map(int,input().split())
    road[S].append((D,L,T))
def dijkstra(start,target):
    heap=[(0,start,0)]
    dist=[[float('inf')]*(K+1) for _ in range(N+1)]
    dist[start][0]=0
    while heap:
        dis,loc,pri=heapq.heappop(heap)
        if dis>dist[loc][pri]:
            continue
        if loc==target:
            return dis
        for i,d,p in road[loc]:
            n_dis=dis+d
            n_p=pri+p
            if n_p<=K and n_dis<dist[i][n_p]:
                dist[i][n_p]=n_dis
                heapq.heappush(heap,(n_dis,i,n_p))
    return -1
print(dijkstra(1,N))
```

